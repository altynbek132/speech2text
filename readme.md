# Speech2Text — Транскрипция аудио и видео через OpenAI Whisper

Этот скрипт позволяет легко преобразовывать речь из аудио и видео файлов в текст, используя API OpenAI Whisper. Основная особенность скрипта — автоматическая обработка больших файлов, которые превышают лимит API (25 МБ).

## Основные возможности

*   **Поддержка видео и аудио**: Работает с форматами `.mp4`, `.mov`, `.avi`, `.mkv`, `.mp3`, `.wav` и многими другими.
*   **Сжатие "на лету"**: Если файл слишком большой, скрипт извлекает аудио и сжимает его до 128 kbps.
*   **Автоматическое разбиение**: Если после сжатия файл всё еще больше 25 МБ, он автоматически разбивается на части, каждая из которых транскрибируется отдельно, а затем текст объединяется.
*   **Простота использования**: Достаточно запустить одну команду в терминале.

## Требования

Для работы скрипта требуются:
1.  **Python 3.7+**
2.  **API ключ OpenAI**
3.  **FFmpeg** (необходим для работы библиотеки `moviepy`)
    *   *macOS*: `brew install ffmpeg`
    *   *Ubuntu/Debian*: `sudo apt update && sudo apt install ffmpeg`
    *   *Windows*: Скачайте с официального сайта ffmpeg.org

## Установка

1.  Клонируйте репозиторий или скачайте файл `transcribe.py`.
2.  Установите необходимые зависимости:

```bash
pip install openai moviepy
```

## Настройка API ключа

Скрипт использует переменную окружения `OPENAI_API_KEY`. Вы можете установить её в терминале перед запуском:

**Для macOS / Linux:**
```bash
export OPENAI_API_KEY='ваш-ключ-здесь'
```

**Для Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY='ваш-ключ-здесь'
```

## Использование

### Базовый запуск
По умолчанию скрипт ищет файл audio.mp3 в текущей директории:
```bash
python transcribe.py
```

### Указание конкретного файла
Вы можете передать путь к любому аудио или видео файлу:
```bash
python transcribe.py path/to/your/video.mp4
```

---

## Как запускать из любого места без `python` (macOS/Linux)

Чтобы запускать скрипт командой `transcribe` из любой папки, выполните следующие шаги:

### 1. Сделайте файл исполняемым
В папке со скриптом выполните:
```bash
chmod +x transcribe.py
```

### 2. Создайте псевдоним (Alias) или ссылку
Самый простой способ — добавить alias в ваш файл конфигурации оболочки (`.zshrc` для macOS или `.bashrc` для Linux).

1. Откройте файл конфигурации (например, для ZSH):
   ```bash
   nano ~/.zshrc
   ```
2. Добавьте в конец файла строку (замените `/полный/путь/к/` на реальный путь к папке со скриптом):
   ```bash
   alias transcribe='/полный/путь/к/transcribe.py'
   ```
3. Сохраните файл и обновите конфигурацию:
   ```bash
   source ~/.zshrc
   ```

**Теперь вы можете просто писать в любой папке:**
```bash
transcribe movie.mp4
```

---

## Как это работает

1.  **Проверка размера**: Если файл меньше 25 МБ и является аудиофайлом, он отправляется в OpenAI напрямую.
2.  **Конвертация**: Если это видео или большой аудиофайл, скрипт использует `moviepy` для создания временного MP3-файла с битрейтом 128k.
3.  **Сегментация**: Если итоговый MP3 всё равно превышает 25 МБ, скрипт делит его на равные части, чтобы уложиться в лимиты Whisper API.
4.  **Сборка**: Текст из всех частей объединяется и выводится в консоль.
5.  **Очистка**: Все временные файлы автоматически удаляются после завершения работы.

## Ограничения
*   Требуется интернет-соединение.
*   Использование Whisper API платно (согласно тарифам OpenAI).
